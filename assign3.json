{"paragraphs":[{"text":"%pyspark\nfrom pyspark import SparkContext\nfrom pyspark.sql import SQLContext\n\n#json.loads\npurchase = sqlContext.read.json(\"gs://de-training-input/alimazon/200000/client-orders/part_*.jsonl.gz\")\npurchase.show()\n\n#1rst Report\ncount_order=purchase.groupBy(\"product_id\").agg({'quantity': 'sum', 'product_id':'count'}).sort(\"count(product_id)\", ascending=False).limit(20)\ncount_order.show()\n\n\nprint \"Final process with the orders showed\"","user":"anonymous","dateUpdated":"2018-08-21T21:31:17+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+--------------------+----------+--------+--------------------+-------+\n|           client_id|                  id|product_id|quantity|           timestamp|  total|\n+--------------------+--------------------+----------+--------+--------------------+-------+\n|c786ac28-0069-4fd...|dfab2420-2b2e-4c9...|B00GHS0FI6|      86|2018-05-24T02:43:...|10466.2|\n|c786ac28-0069-4fd...|43953223-5a2c-428...|B00II05QWQ|      45|2018-05-27T02:43:...|1030.95|\n|c786ac28-0069-4fd...|fe4d5570-8b38-46a...|B00C2UMTIM|      29|2018-06-02T02:43:...|1307.32|\n|c786ac28-0069-4fd...|8226c781-b5c9-402...|B000P6CYVW|      29|2018-06-11T02:43:...|2369.01|\n|c786ac28-0069-4fd...|1220c004-9773-4f6...|B00BB9DPGK|      84|2018-06-14T02:43:...|3050.04|\n|c786ac28-0069-4fd...|99b96283-7f10-43a...|B000MGNY1O|      75|2018-06-20T02:43:...|5259.75|\n|c786ac28-0069-4fd...|e8e91317-93f5-487...|3446162445|      26|2018-06-23T02:43:...| 399.62|\n|c786ac28-0069-4fd...|9d026c25-2e3d-4fc...|0792242076|      24|2018-06-26T02:43:...| 926.64|\n|c786ac28-0069-4fd...|b740795a-5b12-434...|B00CBP3ZCW|      89|2018-06-29T02:43:...|6851.22|\n|bc2a9fdd-dfee-4f9...|e56211db-1319-49c...|B00ANZO8V4|      78|2016-08-31T05:02:...|1994.46|\n|bc2a9fdd-dfee-4f9...|0353ebc2-c883-440...|B00ECMJNAA|      48|2016-09-13T05:02:...|4431.36|\n|bc2a9fdd-dfee-4f9...|05c18416-1536-43b...|B000CZ46GM|      19|2016-09-26T05:02:...| 255.36|\n|bc2a9fdd-dfee-4f9...|0112b8cf-10d8-4e9...|B000FJDH92|      88|2016-10-09T05:02:...|1923.68|\n|bc2a9fdd-dfee-4f9...|acf1cb80-f180-4d3...|1937727246|      12|2016-10-22T05:02:...|  91.08|\n|bc2a9fdd-dfee-4f9...|5d5fbe57-b2e1-46d...|B00KPDU6NS|      62|2016-11-04T05:02:...| 904.58|\n|bc2a9fdd-dfee-4f9...|9c1f7933-4e4e-4b9...|B004001C2Q|      82|2016-11-30T05:02:...| 359.98|\n|bc2a9fdd-dfee-4f9...|5647fdbe-2001-4bd...|B00BI4HQYA|       7|2016-12-13T05:02:...|   97.3|\n|bc2a9fdd-dfee-4f9...|7aa19b13-10e5-421...|B0007WZP1A|      61|2016-12-26T05:02:...| 411.14|\n|bc2a9fdd-dfee-4f9...|6951c2c5-3102-4ed...|B00IPSHF1G|       6|2017-01-08T05:02:...| 163.86|\n|bc2a9fdd-dfee-4f9...|d8fc6466-2443-492...|B005LVY0XG|      87|2017-01-21T05:02:...| 828.24|\n+--------------------+--------------------+----------+--------+--------------------+-------+\nonly showing top 20 rows\n\n+----------+-------------+-----------------+\n|product_id|sum(quantity)|count(product_id)|\n+----------+-------------+-----------------+\n|B009JG4VJ2|        11136|              220|\n|B001K53G1Y|        11795|              219|\n|B00AZGN5U6|         9779|              219|\n|B001CE72X6|        11142|              217|\n|B004169VUO|        10695|              216|\n|B0058NDQAK|        10663|              216|\n|B00H8CNW6W|        10585|              214|\n|0521189721|        10837|              214|\n|1475957408|        10801|              214|\n|B00BF05NUG|        10232|              214|\n|B00H5UW6JQ|        11045|              213|\n|B00ELUTNTO|        10652|              212|\n|B00SDTPOKG|        10418|              212|\n|B00H4LNEJM|        11258|              212|\n|B0002F4MLG|        10369|              212|\n|B00UIJ58FK|        10273|              211|\n|B003RBGKAI|         9825|              211|\n|B009QQ5WJI|        10892|              211|\n|B00BD8OF7C|        10957|              211|\n|B009OHOGL4|        10852|              210|\n+----------+-------------+-----------------+\n\nFinal process with the orders showed\n"}]},"apps":[],"jobName":"paragraph_1534880469930_-711615493","id":"20180821-194109_1701355156","dateCreated":"2018-08-21T19:41:09+0000","dateStarted":"2018-08-21T21:31:17+0000","dateFinished":"2018-08-21T21:38:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1406"},{"text":"%pyspark\nfrom pyspark import SparkContext\nfrom pyspark.sql import SQLContext\nfrom pyspark.sql.functions import to_timestamp\nfrom pyspark.sql.functions import *\nfrom pyspark.sql.window import Window\n\n#json.loads\npurchase = sqlContext.read.json(\"gs://de-training-input/alimazon/50000/client-orders/part_*.jsonl.gz\")\npurchase = purchase.withColumn(\"parsed1\", substring(\"timestamp\",0,10)).withColumn(\"parsed\", to_date(\"parsed1\", \"yyyy-MM-dd\")).withColumn(\"dayofWeek\", date_format(\"parsed\",\"E\"))\n\ncount_order=purchase.groupBy(\"dayofWeek\",\"product_id\").agg({'total': 'sum'}).sort(\"dayofweek\",\"sum(total)\", ascending=False).withColumnRenamed('sum(total)', 'sumT')\n\nfrom pyspark.sql.window import Window\nwindow = Window.\\\n              partitionBy('dayofWeek','product_id').\\\n              orderBy(purchase['total'].desc())\n#df= purchase.withColumn(\"rank_based_on_col5\",rank().over(window))\n#df_w_least = df.filter(\"rank_based_on_col5=1\")\n\ntt=count_order.withColumn(\"rn\",row_number().over(Window.partitionBy(\"dayofWeek\").orderBy(\"sumT\"))).filter( rn< 10)\n\npurchase.show(1,False)\ntt.show()\n","user":"anonymous","dateUpdated":"2018-08-22T00:09:26+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Traceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-502719246328470067.py\", line 367, in <module>\n    raise Exception(traceback.format_exc())\nException: Traceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-502719246328470067.py\", line 355, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 13, in <module>\nNameError: name 'rn' is not defined\n\n"}]},"apps":[],"jobName":"paragraph_1534880853125_-1815676271","id":"20180821-194733_168415732","dateCreated":"2018-08-21T19:47:33+0000","dateStarted":"2018-08-22T00:09:26+0000","dateFinished":"2018-08-22T00:09:29+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:1407"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2018-08-21T19:47:44+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1534880864832_1028402923","id":"20180821-194744_1547776505","dateCreated":"2018-08-21T19:47:44+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1408"}],"name":"assign3","id":"2DNJDS9RM","angularObjects":{"2DN4F8R5X:shared_process":[],"2DQ9TNQ74:shared_process":[],"2DPJESCGU:shared_process":[],"2DP7297A3:shared_process":[],"2DNWYSNKH:shared_process":[],"2DPK52GVD:shared_process":[],"2DPS1FF2N:shared_process":[],"2DPM94R2Q:shared_process":[],"2DPH2CNVM:shared_process":[],"2DP7JSY2Z:shared_process":[],"2DQFG73YQ:shared_process":[],"2DQKEP2YT:shared_process":[],"2DQSVRJU5:shared_process":[],"2DNN85A8N:shared_process":[],"2DP29ZWES:shared_process":[],"2DNAGKRFB:shared_process":[],"2DNREEMDU:shared_process":[],"2DNBNXCQ8:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}